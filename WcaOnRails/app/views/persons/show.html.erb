<% provide(:title, @person.name) %>

<div class="container" id="person">
  <div class="text-center">
    <h2><%= @person.name %></h2>
    <% if @person&.user&.avatar %>
      <%= image_tag @person.user.avatar, class: "avatar" %>
    <% end %>
  </div>

  <div class="details">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Country</th>
          <th>WCA ID</th>
          <%= content_tag :th, "Gender" if @person.gender.present? %>
          <th>Competitions</th>
        </tr>
      </thead>
      <tbody>
        <td><i class="flag f16 <%= @person.country_iso2.downcase %>"></i> <%= @person.country.name %></td>
        <td><%= @person.wca_id %></td>
        <%= content_tag :td, User::GENDER_LABEL_METHOD.call(@person.gender.to_sym) if @person.gender.present? %>
        <td><%= @person.competitions.count %></td>
      </tbody>
    </table>
  </div>

  <div class="personal-records">
    <h3><%= t '.personal_records' %></h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="event"><%= t 'competitions.results_table.event' %></th>
            <th class="country-rank">NR</th>
            <th class="continent-rank">CR</th>
            <th class="world-rank">WR</th>
            <th class="single"><%= t 'common.single' %></th>
            <th class="average"><%= t 'common.average' %></th>
            <th class="world-rank">WR</th>
            <th class="continent-rank">CR</th>
            <th class="country-rank">NR</th>
          </tr>
        </thead>
        <tbody>
          <% @events_competed_in.each do |event| %>
            <% rank_single = @ranks_single.find { |rank| rank.event_id == event.id } %>
            <% rank_average = @ranks_average.find { |rank| rank.event_id == event.id } %>
            <tr>
              <td class="event">
                <%= content_tag :span, "", class: "cubing-icon event-#{event.id}" %>
                <%= t "events.#{event.id}" %>
              </td>
              <%= rank_td rank_single, "country" %>
              <%= rank_td rank_single, "continent" %>
              <%= rank_td rank_single, "world" %>
              <td class="single"><%= rank_single %></td>
              <td class="average"><%= rank_average %></td>
              <%= rank_td rank_average, "world" %>
              <%= rank_td rank_average, "continent" %>
              <%= rank_td rank_average, "country" %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <% if @world_championship_podiums.any? %>
    <div class="wc-podiums">
      <h3><%= t '.wc_podiums' %></h3>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th class="event"><%= t 'competitions.results_table.event' %></th>
              <th class="place"><%= t '.place' %></th>
              <th class="single"><%= t 'common.single' %></th>
              <th class="average"><%= t 'common.average' %></th>
              <th class="solves" colspan="5"><%= t 'common.solves' %></th>
            </tr>
          </thead>
          <tbody>
            <% @world_championship_podiums.group_by(&:competition).each do |competition, results| %>
              <tr>
                <td colspan="9">
                  <%= link_to competition.name, competition, class: "competition-link" %>
                </td>
              </tr>
              <% results.each do |result| %>
                <tr class="result">
                  <td class="event">
                    <%= content_tag :span, "", class: "cubing-icon event-#{result.event.id}" %>
                    <%= t "events.#{result.event.id}" %>
                  </td>
                  <td class="place"><%= result.pos %></td>
                  <td class="single"><%= result.best_solve.clock_format %></td>
                  <td class="average"><%= result.average_solve.clock_format %></td>
                  <%= solve_tds_for_result(result) %>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div>
