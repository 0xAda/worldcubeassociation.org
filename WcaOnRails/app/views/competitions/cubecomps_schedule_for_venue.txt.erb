<% start_date_in_zone = @competition.start_date.in_time_zone(@venue.timezone_id) %>
01
<% gmt_offset = start_date_in_zone.gmt_offset / 3600 %>
GMT<%= gmt_offset > 0 ? "+#{gmt_offset}" : gmt_offset %>
<%= start_date_in_zone.zone %>
1
<%
# We want the cubecomps schedule to be in English
rounds_by_wcif_id = {}
activities = []
I18n.with_locale(:en) do
  rounds_by_wcif_id = Hash[@competition.rounds.map { |r| [r.wcif_id, r.to_string_map] }]
  activities = @venue.all_activities.map { |a| a.to_event(rounds_by_wcif_id) }
end
%>
<% activities_by_start_date = activities.group_by { |a| a[:start].strftime("%Y%m%d") } %>
<% activities_by_start_date.each do |date, activities| %>
<%= date %>
  <% activities.each do |activity| %>
    <% activity_details = activity[:activityDetails] %>
    <% activity_code_without_attempt = "#{activity_details[:event_id]}-r#{activity_details[:round_number]}" %>
    <% round_data = rounds_by_wcif_id[activity_code_without_attempt] || {} %>
    <% line_data = [] %>
    <% line_data << activity[:start].strftime("%H%M") %>
    <% line_data << activity[:end].strftime("%H%M") %>
    <% line_data << cubecomps_id_from_activity_details(activity_details) %>
    <% line_data << cubecomps_title_from_activity(activity) %>
    <% line_data << round_data[:round_type_name] if activity_details[:event_id] != "other" %>
    <% line_data << round_data[:cutoff] unless round_data[:cutoff].blank? %>
<%= line_data.join(",") %>
  <% end %>
<% end %>
