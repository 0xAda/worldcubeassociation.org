<% provide(:title, "Manage schedule for #{@competition.name}") %>
<% provide(:include_gmaps, true) %>
<%= javascript_pack_tag 'edit_schedule' %>

<%= render layout: 'nav' do %>
  <div id="edit-schedule-area"></div>
  <script>
    $(function() {
      competition_info = {
        id: <%= @competition.id.to_json.html_safe %>,
        venue: <%= @competition.venue.to_json.html_safe %>,
        venueDetails: <%= @competition.venueDetails.to_json.html_safe %>,
        lat: <%= @competition.latitude.to_json.html_safe %>,
        lng: <%= @competition.longitude.to_json.html_safe %>,
        countryZones: <%= @competition.country_zones.to_json.html_safe %>,
      }
      // FIXME: here we can simply pass the WCIF, omitting PB for faster rendering?
      wca.initializeScheduleForm(
        competition_info,
        <%= DatePickerInput.date_options_base.to_json.html_safe %>,
        <%= @competition.to_wcif["schedule"].to_json.html_safe %>,
        // Instead of giving *all* TZInfo, use uniq-fied rails "meaningful" subset
        // We'll add the "country_zones" to that, because some of our competitions
        // use TZ not included in this subset.
        <%= Country::ALL_TIMEZONE_MAPPING.to_json.html_safe %>,
        <%= @competition.competition_events.map(&:to_wcif).to_json.html_safe %>,
        <%= I18n.locale.to_json.html_safe %>
      );
    });
  </script>
<% end %>
