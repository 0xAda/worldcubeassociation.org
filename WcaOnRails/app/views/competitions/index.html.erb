<% provide(:title, 'Competitions') %>

<div class="container">
  <h2><%= yield(:title) %></h2>

  <%= form_tag competitions_path, method: :get, class: "competition-select form-inline" do %>
    <% if @competitions.length == 0 %>
      <%= render 'index_form' %>
      <div class="alert alert-warning">No competitions found!</div>
    <% else %>
      <% if params[:display] == "List" %>
        <table class="table competitions-table table-striped table-hover table-condensed floatThead">
          <thead>
            <tr>
              <th colspan="7">
                <%= render 'index_form' %>
              </th>
            </tr>
            <tr>
              <th>Year</th>
              <th>Date</th>
              <th>Name</th>
              <th>Country, City</th>
              <th>Venue</th>
              <th class="big-column"></th>
            </tr>
          </thead>
          <tbody>
            <%= render 'index_table', competitions: @not_past_competitions %>
            <tr id="today-line">
              <td class="text-center"><a id="today"></a>Today</td>
              <td colspan="6" ></td>
            </tr>
            <%= render 'index_table', competitions: @past_competitions %>
          </tbody>
        </table>
      <% else %>
        <%= render 'index_form' %>
        <div class="row">
          <div class="col-xs-12 col-md-12">
            <div id="map"></div>
          </div>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>

<script>
$(function() {
  <% if params[:display] == 'List' %>
    $("#today").scrollToCenter();
  <% else %>
    var competitions = <%= @competitions.map do |c|
        {
          id: c.id,
          name: c.name,
          latitude_degrees: c.latitude_degrees,
          longitude_degrees: c.longitude_degrees,
          cityName: c.cityName,
          marker_date: c.start_date.to_formatted_s(:long),
          is_over: c.is_over?,
          url: competition_path(c)
        }
      end.to_json.html_safe %>;

    $("#map").competitionsMap(competitions);
  <% end %>

  var nav = parseInt($(".navbar").outerHeight(true));
  var head = parseInt($("h2").outerHeight(true));
  var form = parseInt($(".form-group").outerHeight(true));
  var foot = parseInt($(".footer").outerHeight(true));

  var height = parseInt($(window).innerHeight());

  var map = height - nav - head - form - foot;

  $("#map").height( map );
});
</script>
