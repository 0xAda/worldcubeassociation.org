<% provide(:title, t('registrations.edit_registration.title', person: @registration.name, comp: @competition.name)) %>

<%= render layout: 'nav' do %>
  <%= horizontal_simple_form_for @registration, html: { class: 'are-you-sure' } do |f| %>
    <%= hidden_field_tag :from_admin_view, "1" %>
    <%= f.hidden_field :updated_at %>

    <% if @registration.user %>
      <%= alert :info do %>
        <%= t('registrations.registered_with_account_html', here: link_to(t('common.here'), edit_user_path(@registration.user))) %>
      <% end %>
      <%= @registration.name %>
    <% else %>
      <%= alert :info, "This person did not register with an account. You can edit their personal information below." %>

      <%# We can remove this code once competitions only have registrations with accounts. See https://github.com/thewca/worldcubeassociation.org/issues/275 %>
      <%= f.input :name %>
      <%= f.input :birthday, as: :date_picker %>
      <%= f.input :gender, collection: User::ALLOWABLE_GENDERS, label_method: lambda { |g| { m: "Male", f: "Female", o: "Other" }[g] } %>
      <%= f.input :countryId, collection: Country.real, value_method: :id, label_method: :name %>
    <% end %>

    <%= render "shared/associated_events_picker", form_builder: f, events_association_name: :registration_events, allowed_events: @competition.events, selected_events: @registration.saved_and_unsaved_events %>

    <% if @competition.guests_enabled? %>
      <%= f.input :guests %>
    <% end %>

    <%= f.input :comments %>

    <%= f.input :status, as: :radio_buttons, collection: [:a, :p], checked: @registration.accepted? ? :a : :p, include_blank: false %>

    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <%= f.submit class: "btn btn-default" %>
        <%= link_to t('registrations.delete'), registration_path(@registration), method: :delete, class: "btn btn-danger", data: { confirm: t('registrations.admin_delete_confirm', name: @registration.name), toggle: "tooltip" }, title: t('registrations.delete_tooltip', name: @registration.name, mail: @registration.email) %>
      </div>
    </div>
  <% end %>

<% end %>
