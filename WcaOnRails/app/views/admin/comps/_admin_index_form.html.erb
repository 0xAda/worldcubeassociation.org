<div class="form-group">
  <%= label_tag(:region) %>
  <%= select_tag(:region, region_option_tags(selected_id: params[:region]), class: "form-control") %>
</div>

<div class="form-group">
  <%= label_tag("Search") %>
  <div id="search-field">
    <div class="input-group">
      <span class="input-group-addon" data-toggle="tooltip" data-placement="top"
            title="Name, city, venue, country or month">
        <%= icon('search') %>
      </span>
      <%= text_field_tag "search", params[:search], class: "form-control" %>
    </div>
  </div>
</div>

<div class="form-group">
  <%= label_tag(:state) %>
  <div id="state" class="btn-group" data-toggle="buttons">
    <label id="present" class="btn btn-primary">
      <%= radio_button_tag "state", "present" %>
      <span class="caption">Present</span>
    </label>
    <ul class="dropdown-menu years">
      <%= hidden_field_tag "year", params[:year] %>
      <% @years.each do |year| %>
        <li class="year"><%= link_to year.to_s.capitalize, "#", data: { year: year } %></li>
      <% end %>
    </ul>
    <label id="past" class="btn btn-primary" data-toggle="dropdown">
      <%= radio_button_tag "state", "past" %>
      <span class="caption">Past <%= "from #{params[:year]}" if @past_selected %></span>
    </label>
  </div>
</div>

<script>
  $('#<%= @past_selected ? "past" : "present" %>').button('toggle');

  $('#present').on('click', function() {
    $('#past .caption').html('Past');
  });

  $('.years .year a').on('click', function(e) {
    e.preventDefault();
    var $past = $('#past');
    var year = $(this).data('year');
    $past.find('.caption').html('Past from ' + year);
    $('.years input[name="year"]').val(year);
    if($past.is('.active')) {
      $past.trigger('change');
    } else {
      // Also triggers 'change'
      $past.button('toggle');
    }
  });

  $('#<%= params[:display] == "map" ? "display-map" : "display-list" %>').button('toggle');
</script>
