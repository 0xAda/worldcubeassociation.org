<table class="table table-striped table-condensed admin-competitions">
  <thead>
    <tr style="background-color: #ccc;">
      <th>
        <%= "#{title} (#{competitions.count})" %>
      </th>
      <th class="admin-delegate">
        Delegate(s)
      </th>
      <th class="admin-date">
        Date
      </th>
      <th class="admin-date">
        Announced
      </th>
      <th class="admin-date">
        Report posted
      </th>
      <th class="admin-date">
        Results posted
      </th>
      <th class="admin-button">
        <span class="hide-div">(show)</span>
      </th>
    </tr>
  </thead>
  <tbody style="display: none;">
    <% competitions.each_with_index do |competition, index| %>
      <% announced = competition.announced_at %>
      <% report = competition.delegate_report.posted_at %>
      <% results = competition.results_posted_at %>
      <tr>
        <td>
          <i class="flag f16 <%= competition.country.iso2.downcase %>"></i><%= link_to competition.cellName, competition_path(competition) %>
          <br /><strong><%= competition.country_name %></strong>, <%= competition.cityName %>
        </td>
        <td class="admin-delegate">
          <%= competition.delegates.map(&:name).to_sentence %>
        </td>
        <td class="admin-date">
          <%= wca_date_range(competition.start_date, competition.end_date) %>
        </td>
        <% if announced %>
          <% distance_announced = (competition.start_date - announced.to_date).to_i %>
          <% if distance_announced < 15 %>
            <% span_class = "alert-danger" %>
          <% elsif distance_announced < 30 %>
            <% span_class = "alert-orange" %>
          <% else %>
            <% span_class = "alert-success" %>
          <% end %>
        <% end %>
        <td class="admin-date <%= span_class %>">
          <% if announced %>
            <%= announced.strftime("%b %d, %Y") %> (<%= distance_announced %>)
          <% end %>
        </td>
        <% if report %>
          <% distance_report = (report.to_date - competition.end_date).to_i %>
          <% if distance_report > 21 %>
            <% span_class = "alert-danger" %>
          <% elsif distance_report > 14 %>
            <% span_class = "alert-orange" %>
          <% else %>
            <% span_class = "alert-success" %>
          <% end %>
        <% end %>
        <td class="admin-date <%= span_class %>">
          <% if report %>
            <%= report.strftime("%b %d, %Y") %> (<%= distance_report %>)
          <% end %>
        </td>
        <td class="admin-date">
          <% if competition.results_posted_at %>
            <% distance_results = (competition.results_posted_at.to_date - competition.end_date).to_i %>
            <% if distance_results > 21 %>
              <% span_class = "alert-danger" %>
            <% elsif distance_results > 14 %>
              <% span_class = "alert-orange" %>
            <% else %>
              <% span_class = "alert-success" %>
            <% end %>
            <span class="<%= span_class %>"><%= competition.results_posted_at.strftime("%b %d, %Y") %> (<%= distance_results %>)</span>
          <% end %>
        </td>
        <td>
          <%= link_to "Edit", admin_edit_competition_path(competition), class: "btn btn-sm btn-primary", target: "_blank" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  <%# Tooltips have to be initialized manually after each Ajax response in order to work. %>
  $('[data-toggle="tooltip"]').tooltip();
</script>
